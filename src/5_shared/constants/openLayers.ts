// OL 지도제공 관련
import { OlLayer, TileGrid, XYZ } from '@/5_shared/imports/openLayersImports'; // OSM,

const vWorldUrl = import.meta.env.VITE_SERVER_VWORLD_URL;
const vWorldKey = import.meta.env.VITE_SERVER_VWORLD_KEY;

const { extent, resolutions, tileSize } = (() => {
    const sourceXYZ = new XYZ();
    // vWorld의 해상도 8~19로 제한
    // 해상도 설정 // 20번째 줌 레벨 이상에서 해상도를 조정
    const resolutions = sourceXYZ.getTileGrid().getResolutions();
    for (let i = 20; i <= resolutions.length - 1; i++) {
        resolutions[i] = resolutions[i] * 2 - 1;
    }
    const minZoom = sourceXYZ.getTileGrid().getMinZoom();
    return {
        extent: sourceXYZ.getTileGrid().getExtent(),
        resolutions,
        tileSize: sourceXYZ.getTileGrid().getTileSize(minZoom),
    };
})();

const fixedZoomLevel = (coordinate: number[]) => {
    let [z, x, y] = coordinate;

    if (z > 19) {
        x = Math.floor(x / Math.pow(2, z - 19));
        y = Math.floor(y / Math.pow(2, z - 19));
        z = 19;
    }
    return { z, x, y };
};

export const mapSources = new OlLayer({
    visible: true,
    opacity: 0.5,
    source: new XYZ({
        tileUrlFunction: function (coordinate) {
            const { z, x, y } = fixedZoomLevel(coordinate);
            const url = `${vWorldUrl}/${vWorldKey}/Base/${z}/${y}/${x}.png`;
            return url;
        },
        tileGrid: new TileGrid({
            extent,
            resolutions,
            tileSize,
        }),
    }),
    // 하위 두 객체는 v.7에서 제거 -> openLayer에서 자동으로 최적화; updateWhileAnimating, updateWhileInteracting
});

export const examlocations = {
    namYangJu: [127.216544, 37.63604],
    testPosition: [127.956, 37.760699999999986], // 홍천군 화촌면
    testPosition2: [127.45339999999999, 38.28479999999999], // 철원군
};

export const exam_EPSG_3857_1 = [
    [1.4246432490062417e7, 4484685.141632317],
    [1.424647356040485e7, 4484771.53249192],
    [1.4246443688074782e7, 4484785.819258474],
    [1.4246416846270952e7, 4484800.106025028],
    [1.4246405590030637e7, 4484815.691588542],
    [1.4246368790783452e7, 4484841.6675277315],
    [1.4246341327697203e7, 4484873.317506916],
    [1.4246325375260362e7, 4484901.086563639],
    [1.424624915806212e7, 4484998.573677669],
    [1.4246197164934637e7, 4485036.386861293],
    [1.424614162682119e7, 4485065.337580005],
    [1.4246095542003648e7, 4485078.9266928695],
    [1.4245989192424707e7, 4485088.970819769],
    [1.4245931290987281e7, 4485089.561650764],
    [1.4245922428522369e7, 4485080.108354858],
    [1.4245921837691374e7, 4485062.974256028],
    [1.4245939562621199e7, 4484939.4905782575],
    [1.4245939562621199e7, 4484917.629831475],
    [1.4245889041564243e7, 4484933.0],
];

export const exam_EPSG_3857_2 = [
    [1.4309118666058177e7, 4465847.112170331],
    [1.4309129798007257e7, 4465889.034259208],
    [1.4309152061905418e7, 4465944.930636805],
    [1.4309185457752654e7, 4465972.878936646],
    [1.4309218853599893e7, 4465986.85311433],
    [1.430927451334529e7, 4465958.904777471],
    [1.4309385832836082e7, 4465930.9565146435],
    [1.4309396964785162e7, 4465861.086181451],
    [1.4309396964785162e7, 4465805.19024802],
    [1.4309396964785162e7, 4465735.320747626],
    [1.430940809673424e7, 4465707.373077016],
    [1.430940809673424e7, 4465707.373077016],
    [1.4309441492581481e7, 4465693.399269466],
    [1.4309441492581481e7, 4465693.399269466],
    [1.4309463756479638e7, 4465651.477957859],
    [1.4309552812072275e7, 4465581.609475288],
    [1.4309619603766749e7, 4465525.71502232],
    [1.4309626516797699e7, 4465522.084977073],
    [1.4309628809571706e7, 4465514.677569398],
    [1.4309573197864713e7, 4465433.18928211],
    [1.4309553443009427e7, 4465416.659720617],
    [1.4309599304639935e7, 4465317.129038355],
];

export const exam_EPSG_3857_3 = [
    [1.4245548060758376e7, 4483069.0],
    [1.4245584779913183e7, 4483095.037089744],
    [1.4245602956165027e7, 4483106.014826006],
    [1.4245636921252038e7, 4483125.665918812],
    [1.4245691484848555e7, 4483158.804019315],
    [1.4245814816625794e7, 4483232.452849451],
    [1.4245919116580859e7, 4483295.486300556],
    [1.4246011460242357e7, 4483347.0],
    [1.4246042410308974e7, 4483370.154616958],
    [1.424609319985231e7, 4483403.938732838],
    [1.4246146483525006e7, 4483433.868285161],
    [1.4246243502290625e7, 4483487.460202367],
    [1.42462818263717e7, 4483504.02855105],
];

export const exam_EPSG_3857_4 = [
    [1.4245548060758376e7, 4483069.0],
    [1.4245590160840362e7, 4483094.560466424],
];

export const exam_EPSG_3857_5 = [
    [1.4243710063739365e7, 4512033.458887289],
    [1.4243646391097642e7, 4511894.375593391],
    [1.4243629409624495e7, 4511824.0367118465],
    [1.4243629409624495e7, 4511781.931028223],
    [1.4243629409624495e7, 4511753.86066652],
    [1.4243611606278125e7, 4511728.513213655],
    [1.4243607145726336e7, 4511683.685091444],
    [1.4243596811366474e7, 4511662.32698629],
    [1.4243570628355697e7, 4511663.80505948],
    [1.4243565011599438e7, 4511664.122134429],
    [1.4243562617930021e7, 4511669.650032854],
];

export const exam_EPSG_3857_6 = [
    [1.4279172888650311e7, 4520590.207243861],
    [1.4307865139560716e7, 4528987.0],
];

export const exam_EPSG_3857_7 = [
    [1.425083178067882e7, 4557002.827275072],
    [1.425083178067882e7, 4557031.019628071],
    [1.4250842912627902e7, 4557073.308300917],
    [1.4250854044576978e7, 4557115.5971457735],
    [1.4250842912627902e7, 4557143.789804569],
    [1.425083178067882e7, 4557171.982539821],
    [1.4250820648729743e7, 4557200.175351525],
    [1.425084550511711e7, 4557217.12927991],
    [1.425083178067882e7, 4557270.657715267],
    [1.425083178067882e7, 4557355.237182508],
    [1.4250831770338587e7, 4557400.458714938],
    [1.4250839533474272e7, 4557454.800664734],
    [1.425085446258136e7, 4557537.209335854],
    [1.425086132997062e7, 4557592.894905288],
    [1.4250865808702746e7, 4557635.741442627],
    [1.4250870586017014e7, 4557665.002492518],
    [1.4250876308475137e7, 4557693.561932807],
    [1.4250889966341296e7, 4557782.317956519],
    [1.4250891486766936e7, 4557792.198484899],
    [1.4250887440424217e7, 4557905.0204932485],
];

export const exam_EPSG_3857_8 = [
    [1.4243996763944115e7, 4545675.685649667],
    [1.4243996763944115e7, 4545689.766481203],
    [1.4243998419442752e7, 4545739.03458718],
    [1.4243969755557146e7, 4545782.030415591],
    [1.424391899659305e7, 4545842.344008222],
    [1.4243874312504241e7, 4545886.900121503],
    [1.4243852048606083e7, 4545971.387109563],
    [1.4243866520139884e7, 4546014.475737372],
];

export const exam_EPSG_3857_9 = [
    [1.4228121911220064e7, 4481815.434571213],
    [1.422806040329887e7, 4481809.76151052],
    [1.4228068166434554e7, 4481770.647249953],
    [1.4227413077215575e7, 4481625.237746926],
    [1.4227408299901307e7, 4481647.034243273],
    [1.42274032240049e7, 4481675.996711021],
    [1.422737276862644e7, 4481682.565518139],
    [1.4227365304072898e7, 4481713.319478738],
    [1.4227355152280077e7, 4481745.566350047],
    [1.4227331564290881e7, 4481767.362846393],
    [1.422731573943737e7, 4481777.2160570705],
    [1.4227254453221746e7, 4481719.808290991],
];

// export const exam_EPSG_3857_0 = []

export const exam_EPSG_4326 = [
    [127.956, 37.760699999999986],
    [127.956, 37.7608],
    [127.95601487159729, 37.76114989379731],
    [127.95575737953186, 37.76145524158248],
    [127.95530140399936, 37.76188357454568],
    [127.9549, 37.76220000000001],
    [127.9547, 37.7628],
    [127.95482999999999, 37.76310599999998],
];
